(function(){"use strict";var a=this;a.Composer||(a.Composer={version:"1.1.9",exp0rt:function(b){Object.keys(b).forEach(function(c){a.Composer[c]=b[c]})}});var b=function(a,b,c){return c.success()},c=function(){var a=1;return function(b){return"c"+a++}}(),d=function(a,b,c){return function(d){a?a(b,d,c):this.fire_event("error",c,b,d,c)}},e=function(a,b){if(a===b)return!0;if(a instanceof Function)return!1;if(typeof a!=typeof b)return!1;if(a&&a.constructor&&!b||!b.constructor)return!1;if(b&&b.constructor&&!a||!a.constructor)return!1;if(a&&b&&a.constructor!=b.constructor)return!1;if(a instanceof Array||"[object Array]"===Object.prototype.toString.call(a)){if(a.length!=b.length)return!1;for(var c=0,d=a.length;d>c;c++){if(!b.hasOwnProperty(c))return!1;if(!e(a[c],b[c]))return!1}}else if(a instanceof Object){for(var f in b)if(b.hasOwnProperty(f)&&!a.hasOwnProperty(f))return!1;for(var f in a)if(a.hasOwnProperty(f)){if(!b.hasOwnProperty(f))return!1;if(a[f]!==b[f]){if("object"!=typeof a[f])return!1;if(!e(a[f],b[f]))return!1}}}else if(a!=b)return!1;return!0},f=function(b,c){var d=b.extend;b.extend=function(b,e){e||(e=this);var f=e.prototype;c.forEach(function(a){b[a]=Composer.object.merge({},f[a],b[a])});var g=d.call(e,b);return a.Composer.merge_extend(g,c),g}},g={erase:function(a,b){for(var c=a.length-1;c>=0;c--)a[c]===b&&a.splice(c,1)},is:function(){return"isArray"in Array?Array.isArray:function(a){return a instanceof Array||"[object Array]"===Object.prototype.toString.call(a)}}()},h={each:function(a,b,c){a&&(c||(c=this),Object.keys(a).forEach(function(d){b.bind(c)(a[d],d)}))},clone:function(a,b){if(b||(b={}),b.deep)return JSON.parse(JSON.stringify(a));var c={};return Object.keys(a).forEach(function(b){c[b]=a[b]}),c},merge:function(a,b){var c=Array.prototype.slice.call(arguments,1);return c.forEach(function(b){b&&Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},set:function(a,b,c){a||(a={});for(var d=b.split("."),e=a,f=0,g=d.length;g>f;f++){var h=d[f];if(f==g-1){e[h]=c;break}e[h]?("object"!=typeof e||Composer.array.is(e))&&(e[h]={}):e[h]={},e=e[h]}return a},get:function(a,b){a||(a={});for(var c=b.split("."),d=a,e=0,f=c.length;f>e;e++){var g=c[e],h=typeof d[g];if("undefined"==h)return d[g];d=d[g]}return d}},i=function(b){b||(b={});var c=function(c){return function(d){var e=arguments[1]||{},f=e.options_idx||0,g=e.names||["success","error"],h=Composer[c].prototype[d];a.Composer[c].prototype[d]=function(){var a=Array.prototype.slice.call(arguments,0);if(a.length<f){var e=new Array(f);a.forEach(function(a,b){e[b]=a}),a=e}a[f]||(a[f]={});var i=this,j=a[f];return j.promisified?h.apply(i,a):(b.warn&&(j[g[0]]||j[g[1]])&&console.warn("Composer: promisify: attempting to pass callbacks to promisified function: ",c,d),new Promise(function(b,c){g[0]&&(j[g[0]]=b),g[1]&&(j[g[1]]=function(a,b){c(b)}),j.promisified=!0,h.apply(i,a)}))}}},d=c("Collection");["fetch","save","destroy"].forEach(c("Model")),["fetch"].forEach(d),d("reset_async",{options_idx:1,names:["complete"]})};this.Composer.exp0rt({sync:b,cid:c,wrap_error:d,eq:e,merge_extend:f,array:g,object:h,promisify:i})}).apply("undefined"!=typeof exports?exports:this),function(){"use strict";function a(a){return h.extend(a)}var b=function(a){if(null==a)return"null";var b=typeof a;return"object"!=b?b:Array.isArray&&Array.isArray(a)?"array":"[object Array]"===Object.prototype.toString.call(a)?"array":b},c=function(a,b,c){c||(c={});for(var d in b)b.hasOwnProperty(d)&&(c.transform&&c.transform(a,b,d),a[d]=b[d]);return a},d=function(a,b,c){return function(){this.$state.parents[c]||(this.$state.parents[c]=[]),this.$state.parents[c].push(b),this.$state.fn.push(c);var d=a.apply(this,arguments);return this.$state.fn.pop(),this.$state.parents[c].pop(),d}},e=function(a,b){return c(a,b,{transform:function(a,b,c){return"function"!=typeof a[c]||a[c].prototype.$parent||"function"!=typeof b[c]||b[c].prototype.$parent?!1:(b[c]=d(b[c],a[c],c),void(b[c].$parent=a[c]))}})},f=function(a){for(var d in a){var e=a[d];switch(b(e)){case"object":a[d]=f(c({},e));break;case"array":a[d]=e.slice(0)}}return a},g=function(a){a.$initializing=!0;var b=new a;delete a.$initializing;var c=function(){return f(this),c.$initializing?this:(this.$state={parents:{},fn:[]},this.initialize?this.initialize.apply(this,arguments):this)};return c.$constructor=b.$constructor=c,c.prototype=b,c.prototype.$parent=a,c},h=function(){};h.extend=function(a){var b=this,c=g(b);return e(c.prototype,a),c.extend=h.extend,c.prototype.$get_parent=function(){var a=this.$state.fn[this.$state.fn.length-1];if(!a)return!1;var b=this.$state.parents[a],c=b[b.length-1];return c||!1},c.prototype.parent=function(){var a=this.$get_parent();if(a)return a.apply(this,arguments);throw"Class.js: Bad parent method: "+this.$state.fn[this.$state.fn.length-1]},c},a.extend=a,this.Composer.exp0rt({Class:a})}.apply("undefined"!=typeof exports?exports:this),function(a,b){"use strict";var c=function(a,b){return a+"@"+b},d=Composer.Class({_handlers:{},_handler_names:{},bind:function(a,b,d){if(Composer.array.is(a))return a.forEach(function(a){this.bind(a,b,d)}.bind(this)),this;d&&this.unbind(a,d),this._handlers[a]||(this._handlers[a]=[]);var e=this._handlers[a];return e.push(b),d&&(this._handler_names[c(a,d)]=b),this},bind_once:function(a,b,c){c||(c=null);var d=function(){this.unbind(a,d),b.apply(this,arguments)}.bind(this);return this.bind(a,d,c)},unbind:function(a,b){if(!a)return this.wipe();if(Composer.array.is(a))return a.forEach(function(a){this.unbind(a,b)}.bind(this)),this;if(!b)return this.unbind_all(a);var d=b instanceof Function,e=d?null:c(a,b),f=d?b:this._handler_names[e];if(!f)return this;if(d||delete this._handler_names[e],!this._handlers[a])return this;var g=this._handlers[a].indexOf(f);return 0>g?this:(this._handlers[a].splice(g,1),this)},unbind_all:function(a){return delete this._handlers[a],this},wipe:function(a){return a||(a={}),this._handlers={},this._handler_names={},this},trigger:function(a,b){var c=Array.prototype.slice.call(arguments,0),d=this._handlers[a]||[],e=this._handlers.all||[];return d.slice(0).forEach(function(a){a.apply(this,c.slice(1))}.bind(this)),e.slice(0).forEach(function(a){a.apply(this,c.slice(0))}.bind(this)),this}});d._make_lookup_name=c,this.Composer.exp0rt({Event:d})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=Composer.Event.extend({__composer_type:"base",options:{},_cid:!1,initialize:function(){this._cid=Composer.cid()},cid:function(){return this._cid},set_options:function(a){a||(a={}),Object.keys(a).forEach(function(b){this.options[b]=a[b]}.bind(this))},fire_event:function(){var a=Array.prototype.slice.call(arguments,0),b=a.shift(),c=a.shift();return c||(c={}),a.unshift(b),c.silent||c.not_silent?c.not_silent&&(c.not_silent==b||c.not_silent.indexOf&&c.not_silent.indexOf(b)>=0)?this.trigger.apply(this,a):c.silent&&("string"==typeof c.silent&&c.silent!=b||c.silent.indexOf&&!(c.silent.indexOf(b)>=0))?this.trigger.apply(this,a):this:this.trigger.apply(this,a)}});this.Composer.exp0rt({Base:a})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=Composer.Base.extend({__composer_type:"model",defaults:{},data:{},_changed:!1,collections:[],id_key:"id",url:!1,base_url:!1,validate:function(a,b){return!1},initialize:function(a,b){a||(a={});var c={},d=function(a,b){c[b]=a};Composer.object.each(Composer.object.clone(this.defaults),d),Composer.object.each(a,d),this.parent(),this.set(c,b),this.init(b)},init:function(){},get:function(a,b){return"undefined"==typeof b&&(b=null),"undefined"==typeof this.data[a]?b:this.data[a]},escape:function(a){var b=this.get(a);return null==b||"string"!=typeof b?b:b.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(a){return null!=this.data[a]},set:function(a,b){if(b||(b={}),!b.silent&&!this.perform_validation(a,b))return!1;var c=this.changing;return this.changing=!0,Composer.object.each(a,function(a,c){Composer.eq(a,this.data[c])||(this.data[c]=a,this._changed=!0,this.fire_event("change:"+c,b,this,a,b))}.bind(this)),!c&&this._changed&&(this.fire_event("change",b,this,b,a),this._changed=!1),this.changing=!1,this},unset:function(a,b){if(!(a in this.data))return this;b||(b={});var c={};return c[a]=void 0,b.silent||this.perform_validation(c,b)?(delete this.data[a],this._changed=!0,this.fire_event("change:"+a,b,this,void 0,b),this.fire_event("change",b,this,b),this._changed=!1,this):!1},clear:function(a){a||(a={});var b=this.data,c={};for(var d in b)c[d]=void 0;if(!a.silent&&!this.perform_validation(c,a))return!1;if(this.data={},!a.silent){for(var d in b)this._changed=!0,this.fire_event("change"+d,a,this,void 0,a);this._changed&&(this.fire_event("change",a,this,a),this._changed=!1)}return this},fetch:function(a){a||(a={});var b=a.success;return a.success=function(c){this.set(this.parse(c),a),b&&b(this,c)}.bind(this),a.error=Composer.wrap_error(a.error?a.error.bind(this):null,this,a).bind(this),(this.sync||Composer.sync).call(this,"read",this,a)},save:function(a){if(a||(a={}),!this.perform_validation(this.data,a))return!1;var b=a.success;return a.success=function(c){return this.set(this.parse(c),a)?void(b&&b(this,c)):!1}.bind(this),a.error=Composer.wrap_error(a.error?a.error.bind(this):null,this,a).bind(this),(this.sync||Composer.sync).call(this,this.is_new()?"create":"update",this,a)},destroy:function(a){a||(a={});var b=a.success;return a.success=function(c){this.fire_event("destroy",a,this,this.collections,a),b&&b(this,c)}.bind(this),this.is_new()&&!a.force?a.success():(a.error=Composer.wrap_error(a.error?a.error.bind(this):null,this,a).bind(this),(this.sync||Composer.sync).call(this,"delete",this,a))},parse:function(a){return a},id:function(a){"boolean"!=typeof a&&(a=!1);var b=this.get(this.id_key);return b?b:a?!1:this.cid()},is_new:function(){return!this.id(!0)},clone:function(){return new this.$constructor(this.toJSON())},toJSON:function(){return Composer.object.clone(this.data,{deep:!0})},perform_validation:function(a,b){if("function"!=typeof this.validate)return!0;var c=this.validate(a,b);return c?(b.error?b.error(this,c,b):this.fire_event("error",b,this,c,b),!1):!0},highest_priority_collection:function(){var a=this.collections.slice(0);return a.sort(function(a,b){return b.priority-a.priority}),a.length?a[0]:!1},get_url:function(){if(this.url)return this.url;if(this.base_url)var a=this.base_url;else{var b=this.highest_priority_collection();if(b)var a=b.get_url();else var a=""}var c=this.id(!0);c=c?"/"+c:"";var d=a?"/"+a.replace(/^\/+/,"").replace(/\/+$/,"")+c:c;return d}});this.Composer.exp0rt({Model:a})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=this,b=Composer.Base.extend({__composer_type:"collection",model:Composer.Model,_models:[],_id_idx:{},_cid_idx:{},sortfn:null,url:"/mycollection",priority:1,initialize:function(b,c,d){c||(c={});for(var e in c)this[e]=c[e];this.parent(),this.model="string"==typeof this.model?a[this.model]:this.model,b&&this.reset(b,d),this.init()},init:function(){},toJSON:function(){return this.models().map(function(a){return a.toJSON()})},models:function(){return this._models},size:function(){return this.models().length},add:function(a,b){if(Composer.array.is(a))return a.forEach(function(a){this.add(a,b)}.bind(this));b||(b={});var c=a instanceof Composer.Model?a:new this.model(a,b);if(-1==c.collections.indexOf(this)&&(c.collections.push(this),b.is_new=!0),this.sortfn){var d=b.at?parseInt(b.at):this.sort_index(c);this._models.splice(d,0,c)}else"number"==typeof b.at?this._models.splice(b.at,0,c):this._models.push(c);return c.bind("all",this._model_event.bind(this,c),"collection:"+this.cid()+":listen:model:all"),this._index_model(c),this.fire_event("add",b,c,this,b),c},remove:function(a,b){if(Composer.array.is(a))return a.slice(0).forEach(function(a){this.remove(a,b)}.bind(this));if(a){b||(b={}),Composer.array.erase(a.collections,this);var c=this._models.length;Composer.array.erase(this._models,a),this._remove_reference(a),this._models.length!=c&&this.fire_event("remove",b,a)}},upsert:function(a,b){if(Composer.array.is(a))return a.forEach(function(a){this.upsert(a,b)}.bind(this));b||(b={});var c=a instanceof Composer.Model?a:new this.model(a,b),d=this.find_by_id(c.id(),b);if(d){var e=this.index_of(d);return"number"==typeof b.at&&e!=b.at&&(this._models.splice(e,1),this._models.splice(b.at,0,d),this.fire_event("sort",b)),d.set(c.toJSON(),Composer.object.merge({},{silent:!0,upsert:!0},b)),this.fire_event("upsert",b,d,b),d}return this.add(c,b),c},clear:function(a){a||(a={});var b=this._models.length;0!=b&&(this.remove(this._models,a),this._models=[],this._models.length!=b&&this.fire_event("clear",a,a))},reset:function(a,b){b||(b={}),b.append||b.upsert||this.clear(b),b.upsert?this.upsert(a,b):this.add(a,b),this.fire_event("reset",b,b)},reset_async:function(a,b){if(b||(b={}),void 0!=a){if(Composer.array.is(a)||(a=[a]),a=a.slice(0),b.append||b.upsert||this.clear(),a.length>0){var c=b.batch||1,d=a.splice(0,c);b.upsert?this.upsert(d,b):this.add(d,b)}return 0==a.length?(this.fire_event("reset",b,b),void(b.complete&&b.complete())):void setTimeout(function(){this.reset_async(a,Composer.object.merge({append:!0},b))}.bind(this),0)}},sort:function(a){return this.sortfn?(this._models.sort(this.sortfn),void this.fire_event("reset",a,a)):!1},sort_index:function(a){if(0==this._models.length)return 0;if(!this.sortfn){var b=this.index_of(a);return b===!1||0>b?this.size():b}for(var c=this._models.slice(0).sort(this.sortfn),d=0;d<c.length;d++){if(a==c[d])return d;if(this.sortfn(c[d],a)>0)return d}var e=c.indexOf(a);return e==c.length-1?e:c.length},parse:function(a){return a},each:function(a,b){b||(b=this),this.models().forEach(a.bind(b))},map:function(a,b){return b||(b=this),this.models().map(a.bind(b))},find:function(a,b){var c=this.models();b&&(c=c.slice(0).sort(b));for(var d=0;d<c.length;d++){var e=c[d];if(a(e))return e}return!1},exists:function(a){for(var b=0;b<this.size();b++)if(a(this.models()[b]))return!0;return!1},find_by_id:function(a,b){b||(b={});var c=this._id_idx[a];return b.fast?c||!1:c||this.find(function(c){return c.id(b.strict)==a?!0:b.allow_cid&&c.cid()==a?!0:void 0})},find_by_cid:function(a,b){b||(b={});var c=this._cid_idx[a];return b.fast?c||!1:c||this.find(function(b){return b.cid()==a?!0:void 0})},get:function(a){return this.find_by_id.apply(this,arguments)},index_of:function(a){for(var b="model"==a.__composer_type?a.id():a,c=0;c<this._models.length;c++)if(this._models[c].id()==b)return c;return!1},filter:function(a,b){return b||(b=this),this._models.filter(a.bind(b))},select:function(a){if("object"==typeof a){var b=a,c=Object.keys(b);a=function(a){for(var d=0;d<c.length;d++){var e=c[d],f=b[e];if(a.get(e)!==f)return!1}return!0}}return this._models.filter(a)},select_one:function(a){var b=this.select(a);return b.length?b[0]:null},first:function(a){var b=this.models();return"undefined"!=typeof a&&0!=parseInt(a)?b.slice(0,a):b[0]},last:function(a){var b=this.models();return"undefined"!=typeof a&&0!=parseInt(a)?b.slice(b.length-a):b[b.length-1]},at:function(a){var b=this._models[a];return b||!1},sort_at:function(a){if(!this.sortfn)return!1;var b=this._models.slice(0).sort(this.sortfn);return b[a]},fetch:function(a){a||(a={});var b=a.success;return a.success=function(c){this.reset(this.parse(c),a),b&&b(this,c)}.bind(this),a.error=Composer.wrap_error(a.error?a.error.bind(this):null,this,a).bind(this),(this.sync||Composer.sync).call(this,"read",this,a)},get_url:function(){return this.url},_index_model:function(a){var b=a.id(!0);b&&(this._unindex_model(a),this._id_idx[b]=a,a._tracked_ids.push(b)),this._cid_idx[a.cid()]=a},_unindex_model:function(a){a._tracked_ids||(a._tracked_ids=[]),a._tracked_ids.forEach(function(a){delete this._id_idx[a]}.bind(this)),delete this._cid_idx[a.cid()]},_remove_reference:function(a){this._unindex_model(a),Composer.array.erase(a.collections,this),a.unbind("all","collection:"+this.cid()+":listen:model:all")},_model_event:function(a,b,c){b=="change:"+a.id_key&&this._index_model(a),"destroy"==b&&this.remove(a,arguments[4]);var d=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,d)}});this.Composer.exp0rt({Collection:b})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=this,b=!!a.Sizzle,c=!!a.jQuery,d=!!a.Slick,e=(!!a.MooTools,function(){if(d)return function(a,b){return a||(a=document),Slick.find(a,b)};if(b)return function(a,b){return a||(a=document),Sizzle.select(b,a)[0]};if(c)return function(a,b){return a||(a=document),jQuery(a).find(b)[0]};if("querySelector"in document){var a=!1;try{document.querySelector(":scope > h1"),a=!0}catch(e){}return function(b,c){return b||(b=document),a&&(c=":scope "+c),b.querySelector(c)}}throw new Error("No selector engine present. Include Sizzle/jQuery or Slick/Mootools before loading composer (or use a modern browser with document.querySelector).")}()),f=function(){if(d)return function(a,b){return a||(a=document),Slick.match(a,b)};if(b)return function(a,b){return a||(a=document),Sizzle.matchesSelector(a,b)};if(c)return function(a,b){return a||(a=document),jQuery(a).is(b)};if("querySelector"in document)return function(a,b){if(a||(a=document),"matches"in a)var c=a.matches;if("msMatchesSelector"in a)var c=a.msMatchesSelector;if("mozMatchesSelector"in a)var c=a.mozMatchesSelector;if("webkitMatchesSelector"in a)var c=a.webkitMatchesSelector;return c.call(a,b)};throw new Error("No selector engine present. Include Sizzle/jQuery or Slick/Mootools before loading composer.")}(),g={focus:!0,blur:!0},h=function(){return function(a,b,c,d){var e=g[b]||!1;d?a.addEventListener(b,function(b){b&&window.MooTools&&window.DOMEvent&&(b=new DOMEvent(b));for(var e=b.target||b.srcElement;e;){if(f(e,d)){c.apply(this,[b].concat(b.params||[]));break}e=e.parentNode,(e==a.parentNode||e==document.body.parentNode)&&(e=!1)}},e):a.addEventListener(b,function(a){a&&window.MooTools&&window.DOMEvent&&(a=new DOMEvent(a)),c.apply(this,[a].concat(a.params||[]))},e)}}(),i=function(){return function(a,b,c){a.removeEventListener(b,c,!1)}}(),j=function(){return function(a,b,c){if(c||(c={}),"click"==b&&a.click)return a.click();var d=new CustomEvent(b,c.args);a.dispatchEvent(d)}}(),k=function(a,b){if(!b)return!1;if(f(b,a))return b;var c=b.parentNode;return k(a,c)};this.Composer.exp0rt({find:e,match:f,add_event:h,fire_event:j,remove_event:i,find_parent:k})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=Composer.Base.extend({__composer_type:"controller",_released:!1,_bound_events:[],_subcontrollers:{},el:!1,inject:!1,tag:"div",class_name:!1,elements:{},events:{},initialize:function(a,b){b||(b={});for(var c in a)this[c]=a[c];this.parent(),this._ensure_el(),this.inject&&this.attach(b),this.className&&(this.class_name=this.className),this.class_name&&(this.el.className+=" "+this.class_name),this.refresh_elements(),this.delegate_events(),this.init()},init:function(){},render:function(){return this},html:function(a){this.el||this._ensure_el(),a.appendChild&&a.tagName?(this.el.innerHTML="",this.el.appendChild(a)):this.el.innerHTML=a,this.refresh_elements()},attach:function(a){a||(a={}),this._ensure_el();var b="string"==typeof this.inject?Composer.find(document,this.inject):this.inject;return b?(a.clean_injection&&(b.innerHTML=""),void b.appendChild(this.el)):!1},_with_binder:function(a,b,c,d,e){e||(e=!1);var f=function(){this._released||d.apply(this,arguments)}.bind(this);a.call(b,c,f,e),this._bound_events.push([b,c,f])},with_bind:function(a,b,c,d){return this._with_binder(a.bind,a,b,c,d)},with_bind_once:function(a,b,c,d){return this._with_binder(a.bind_once,a,b,c,d)},track_subcontroller:function(a,b){var c=function(a,b){this._subcontrollers[a]&&(b||this._subcontrollers[a].release(),delete this._subcontrollers[a])}.bind(this);c(a);var d=b();return d.bind("release",function(){c(a,!0)}),this._subcontrollers[a]=d,d},get_subcontroller:function(a){return this._subcontrollers[a]||!1},_ensure_el:function(){"string"==typeof this.el&&(this.el=Composer.find(document,this.el)),this.el||(this.el=document.createElement(this.tag))},release:function(a){a||(a={}),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=!1,this._bound_events.forEach(function(a){var b=a[0],c=a[1],d=a[2];b.unbind(c,d)}),this._bound_events=[],Object.keys(this._subcontrollers).forEach(function(a){this._subcontrollers[a].release()}.bind(this)),this._subcontrollers={},this.fire_event("release",a,this),a.keep_events||this.unbind(),this._released=!0},replace:function(a){return this.el.parentNode&&this.el.parentNode.replaceChild(a,this.el),this.el=a,this.refresh_elements(),this.delegate_events(),a},delegate_events:function(){for(var a in this.events){var b=this[this.events[a]];if("function"==typeof b){b=b.bind(this);var c=a.match(/^(\w+)\s*(.*)$/),d=c[1].trim(),e=c[2].trim();""==e?(Composer.remove_event(this.el,d,b),Composer.add_event(this.el,d,b)):Composer.add_event(this.el,d,b,e)}}},refresh_elements:function(){return this.elements?void Object.keys(this.elements).forEach(function(a){var b=this.elements[a];this[b]=Composer.find(this.el,a)}.bind(this)):!1}});this.Composer.merge_extend(a,["events","elements"]),this.Composer.exp0rt({Controller:a})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=Composer.Controller.extend({__composer_type:"listcontroller",_subcontroller_list:[],_subcontroller_idx:{},_collection:null,_empty:!0,track:function(a,b,c){c||(c={}),this.set_options(c),this._collection=a,a.size()>0&&(this._empty=!1),this.with_bind(a,["clear","add","remove","reset"],function(){var b=0==a.size();this._empty&&!b&&this.trigger("list:notempty"),!this._empty&&b&&this.trigger("list:empty"),this._empty=b}.bind(this)),this.trigger("list:"+(this._empty?"empty":"notempty")),this.with_bind(a,"clear",function(a){this.clear_subcontrollers()}.bind(this)),this.with_bind(a,"add",function(a,c,d){this.add_subcontroller(a,b,d)}.bind(this)),this.with_bind(a,"remove",function(a){this.remove_subcontroller(a)}.bind(this)),c.bind_reset&&this.with_bind(a,"reset",function(a){this.reset_subcontrollers(b,a)}.bind(this)),this.reset_subcontrollers(b)},release:function(){return this.clear_subcontrollers(),this.parent.apply(this,arguments)},index_controller:function(a,b){return a?(this._subcontroller_idx[a.cid()]=b,void this._subcontroller_list.push(b)):!1},unindex_controller:function(a,b){return a?(delete this._subcontroller_idx[a.cid()],void(this._subcontroller_list=this._subcontroller_list.filter(function(a){return a!=b}))):!1},lookup_controller:function(a){return a?this._subcontroller_idx[a.cid()]:!1},clear_subcontrollers:function(){this._subcontroller_list.forEach(function(a){a.release()}),this._subcontroller_list=[],this._subcontroller_idx={}},reset_subcontrollers:function(a,b){this.clear_subcontrollers(),this._collection.each(function(c){this.add_subcontroller(c,a,b)},this)},add_subcontroller:function(a,b,c){var d=b(a,c);this.index_controller(a,d),d.bind("release",function(){this.unindex_controller(a,d)}.bind(this));var e=this._collection.sort_index(a),f=this._collection.sort_at(e-1)||!1,g=this.lookup_controller(f),h=d.el.parentNode;0==e?h.insertBefore(d.el,h.firstChild):g&&g.el.parentNode==h?h.insertBefore(d.el,g.el.nextSibling):h.appendChild(d.el)},remove_subcontroller:function(a){var b=this.lookup_controller(a);return b?(b.release(),void this.unindex_controller(a,b)):!1}});this.Composer.exp0rt({ListController:a})}.apply("undefined"!=typeof exports?exports:this),function(a,b){"use strict";var a=this,c=Composer.Base.extend({__composer_type:"router",last_path:!1,_last_url:null,routes:{},options:{suppress_initial_route:!1,enable_cb:function(a){return!0},process_querystring:!1,base:!1},initialize:function(b,c){if(this.set_options(c),this.routes=b,this.bind("route",this._do_route.bind(this)),a.History||(a.History={enabled:!1}),!History.enabled)throw"History.js is *required* for proper router operation: https://github.com/browserstate/history.js";this.bind("statechange",this.state_change.bind(this)),this.bind_once("destroy",function(){Object.keys(History.Adapter.handlers).forEach(function(a){delete History.Adapter.handlers[a]}),delete a.onstatechange}),History.Adapter.bind(a,"statechange",function(a){a||(a=[this.cur_path()]);var b=a[0],c=a[1];this.trigger("statechange",b,c)}.bind(this)),this.options.suppress_initial_route||History.Adapter.trigger(a,"statechange",[this.cur_path()])},destroy:function(){this.trigger("destroy"),this.unbind()},debasify:function(a){return this.options.base&&0==a.indexOf(this.options.base)&&(a=a.substr(this.options.base.length)),a},cur_path:function(){if(History.emulated.pushState)var b="/"+new String(a.location.hash).toString().replace(/^[#!\/]+/,"");else var b=a.location.pathname+a.location.search;return this.debasify(decodeURIComponent(b))},get_param:function(a,b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(a);return null==d?null:decodeURIComponent(d[1].replace(/\+/g," "))},route:function(a,b){a||(a=this.cur_path()),b||(b={}),b.state||(b.state={});var c=this.options.base||"",d=a.trim().replace(/^[a-z]+:\/\/.*?\//,"").replace(/^[#!\/]+/,"");b.raw||(d=decodeURIComponent(d));var e=c+"/"+d,f=c+this.cur_path();f==e?this.trigger("statechange",e,!0):History.emulated.pushState?(History.saveHash(a),window.location.hash="#"+e,this.trigger("statechange",e,!0)):b.replace_state?History.replaceState(b.state,"",e):History.pushState(b.state,"",e)},_do_route:function(b,c){if(!this.options.enable_cb(b))return!1;c||(c=this.routes);var d=this.find_matching_route(b,c);if(!d)return this.trigger("fail",{url:b,route:!1,handler_exists:!1,action_exists:!1});var e=d.route,f=d.args,g=e[0],h=e[1];if("object"!=typeof g){if(!a[g])return this.trigger("fail",{url:b,route:e,handler_exists:!1,action_exists:!1});var g=a[g]}if(!g[h]||"function"!=typeof g[h])return this.trigger("fail",{url:b,route:e,handler_exists:!0,action_exists:!1});var i=f;i.shift(),this._last_url=b,this.trigger("route-success",e),g[h].apply(g,i)},find_matching_route:function(a,b){var a="/"+a.replace(/^!?\//g,""),c=!1,d=[],e=null;for(var f in b)if(e=new RegExp("^"+f.replace(/\//g,"\\/")+"$"),d=e.exec(a)){c=b[f];break}return c?{route:c,args:d,regex:e}:!1},state_change:function(a,c){if(a&&a.stop!=b&&(a=!1),a&&(a=this.debasify(a)),a||(a=this.cur_path()),c=!!c,this.last_path==a&&!c)return!1;this.last_path=a,this.options.process_querystring||(a=a.replace(/\?.*/,"")),a=new String(a);var d={path:a};this.trigger("preroute",d),this.trigger("route",d.path)},last_url:function(){return this._last_url},bind_links:function(b){b||(b={});var c="a";b.selector?c=b.selector:b.exclude_class&&(c='a:not([class~="'+b.exclude_class+'"])');var d=b.bind_element||document.body,e=function(d){if(!d.defaultPrevented&&!(d.ctrlKey||d.shiftKey||d.altKey)){var e=Composer.find_parent(c,d.target),f="undefined"!=typeof d.button?d.button:d.event.button;if(!("_blank"==e.target||f>0||e.href.match(/^javascript:/)||e.href.match(/^mailto:/)||History.emulated.pushState&&""==e.href.replace(/^.*?#/,""))){var g=a.location.host,h=e.href.match(/^[a-z]+:\/\//)?e.href.replace(/[a-z]+:\/\/(.*?)\/.*/i,"$1"):g;if(g==h&&(!b.do_state_change||b.do_state_change(e))){d&&d.preventDefault();var i=e.href.replace(/^[a-z]+:\/\/.*?\//,"").replace(/^[#!\/]+/,"");b.filter_trailing_slash&&(i=i.replace(/\/$/,"")),i="/"+i,this.route(i,{state:b.global_state})}}}}.bind(this);Composer.add_event(d,"click",e,c)}});this.Composer.exp0rt({Router:c})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=this,b=Composer.Model.extend({relations:!1,relation_data:{},skip_relational_serialize:!1,initialize:function(b,c){return c||(c={}),this.relations&&Composer.object.each(this.relations,function(b,c){if(b.model&&"string"==typeof b.model)b.model=Composer.object.get(a,b.model);else if(b.collection&&"string"==typeof b.collection)b.collection=Composer.object.get(a,b.collection);else if(b.filter_collection&&"string"==typeof b.filter_collection){b.filter_collection=Composer.object.get(a,b.filter_collection);var d=b.master;if("string"==typeof d){var e=b.master;b.master=function(){var a=Composer.object.get(this.relation_data,e);return a||(a=new this.relations[e].collection,Composer.object.set(this.relation_data,e)),a}.bind(this),b.master()}}if(!b.delayed_init){this._create_obj(b,c,{set_parent:!0})}},this),this.parent(b,c)},toJSON:function(a){a||(a={});var b=this.parent();return a.raw?b:(this.skip_relational_serialize||a.skip_relational?Object.keys(this.relations).forEach(function(a){delete b[a]}):Object.keys(this.relations).forEach(function(a){var c=Composer.object.get(this.relation_data,a);c&&Composer.object.set(b,a,c.toJSON())}.bind(this)),b)},set:function(a,b){return b||(b={}),this.relations&&!b.skip_relational&&Composer.object.each(this.relations,function(c,d){var e=Composer.object.get(a,d);if("undefined"!=typeof e){var f=Composer.object.clone(b);f.data=e;this._create_obj(c,d,f)}},this),this.parent(a,b)},get:function(a,b){var c=Composer.object.get(this.relation_data,a);return"undefined"!=typeof c?c:this.parent(a,b)},clear:function(a){return a||(a={}),this.relations&&!a.skip_relational&&Composer.object.each(this.relations,function(a,b){var c=Composer.object.get(this.relation_data,b);"undefined"!=typeof c&&c.clear&&"function"==typeof c.clear&&c.clear()},this),this.parent.apply(this,arguments)},bind_relational:function(a){var b=this.relations[a];if(!b)return!1;var c=this._create_obj(b,a),d=Array.prototype.slice.call(arguments,0);c.bind.apply(c,d.slice(1))},unbind_relational:function(a){var b=this.relations[a];if(!b)return!1;var c=Composer.object.get(this.relation_data,a);if(!c)return!1;var d=Array.prototype.slice.call(arguments,0);c.unbind.apply(c,d.slice(1))},set_parent:function(a,b){b.get_parent=function(){return a}},get_parent:function(a){return a.get_parent()},_create_obj:function(a,b,c){c||(c={});var d=c.data;if(delete c.data,d&&d.__composer_type&&""!=d.__composer_type)var e=d;else{var e=Composer.object.get(this.relation_data,b),f=a.collection||a.filter_collection?"collection":"model";switch(f){case"model":e||(e=new a.model),c.set_parent&&this.set_parent(this,e),d&&e.set(d,c);break;case"collection":e||(a.collection?e=new a.collection:a.filter_collection&&(e=new a.filter_collection(a.master(),Composer.object.merge({skip_initial_sync:!0},a.options)))),c.set_parent&&this.set_parent(this,e),d&&e.reset(d,c)}}return Composer.object.set(this.relation_data,b,e),this.trigger("relation",e,b),this.trigger("relation:"+b,e),e}});this.Composer.merge_extend(b,["relations"]),this.Composer.exp0rt({HasOne:-1,HasMany:-1,RelationalModel:b})}.apply("undefined"!=typeof exports?exports:this),function(){"use strict";var a=Composer.Collection.extend({__composer_type:"filtercollection",master:null,filter:function(){return!0},transform:null,limit:!1,options:{forward_all_events:!1,refresh_on_change:!1,sort_event:!1},initialize:function(a,b){b||(b={});var c=Object.keys(this.options);return Object.keys(b).forEach(function(a){var d=b[a];"function"==typeof d&&(d=d.bind(this)),c.indexOf(a)>=0?this.options[a]=d:this[a]=d}.bind(this)),this.parent(),this.master=a,this.master&&this.filter?(this.attach(b),void(b.skip_initial_sync||this.refresh())):!1},attach:function(){this.master.bind("all",this.match_action.bind(this),"filtercollection:"+this.cid()+":all"),this.bind("reset",function(a){return a||(a={}),a.has_reload?!1:void this.refresh(a)}.bind(this),"filtercollection:reset")},detach:function(){this.master.unbind("all","filtercollection:"+this.cid()+":all"),this.unbind("reset","filtercollection:reset")},match_action:function(a,b){var c=Array.prototype.slice.call(arguments,0);switch(a){case"add":this.add_event(b,{from_event:!0});break;case"reset":this.refresh();break;case"clear":this.clear();break;case"remove":this.remove_event(b,{from_event:!0});break;case"change":this.change_event(b,{},c);
break;case"sort":this.refresh();break;default:this.forward_event(a,b,c)}},refresh:function(a){if(a||(a={}),a.diff_events)var b=this._models;if(this._models=this.master._models.filter(function(a){return this.filter(a,this)}.bind(this)),this.sort({silent:!0}),this.limit&&this._models.splice(this.limit,this._models.length),a.diff_events){var c=function(a,b){return a.filter(function(a){return b.indexOf(a)<0})};c(b,this._models).forEach(function(b){this.fire_event("remove",a,b)},this),c(this._models,b).forEach(function(b){this.fire_event("add",a,b)},this)}this.fire_event("reset",a,{has_reload:!0})},change_event:function(a,b,c){if(b||(b={}),!a||this.models().indexOf(a)<0&&!this.filter(a,this))return!1;var d=this._models.length;if(this.options.refresh_on_change)this.refresh({silent:!0});else{var e=this._models.indexOf(a),f=this.sort_index(a);-1==e&&this.filter(a,this)?this.add(a,b):e>-1&&!this.filter(a,this)?this.remove(a,b):e!=f&&(this.options.sort_event?(this.sort(Composer.object.merge({},b,{silent:!0})),this.fire_event("sort",b)):this.sort(b))}if(this._models.length==d){c.shift();var g=["change",b].concat(c);this.fire_event.apply(this,g)}else this.fire_event("reset",b)},add:function(a,b){if(Composer.array.is(a))return Composer.object.each(a,function(a){this.add(a,b)},this);b||(b={}),"undefined"==typeof b.transform&&(b.transform=!0);var c="model"==a.__composer_type?a:new this.master.model(a,b);if(this.transform&&b.transform&&(c=this.transform.call(this,c,"add")),!this.filter(c,this))return!1;if("number"==typeof b.at){var d=this.at(b.at),e=this.master.index_of(d);e!==!1&&(b.at=e)}return this.master.index_of(c)?this._do_add(c,b):(this.master.add(c,b),this.limit&&this._models.splice(this.limit)),c},_do_add:function(a,b){this._models.push(a);var c=this._models.indexOf(a);this.sort({silent:!0});var d=this._models.indexOf(a);this.limit&&this._models.splice(this.limit),this.index_of(a)&&(this.fire_event("add",b,a,this,b),c!=d&&(this.options.sort_event?this.fire_event("sort",b):this.fire_event("reset",b)))},remove:function(a,b){return Composer.array.is(a)?Composer.object.each(a,function(a){this.remove(a)},this):(b||(b={}),"undefined"==typeof b.transform&&(b.transform=!0),this._models.indexOf(a)<0?!1:(this.transform&&b.transform&&(a=this.transform.call(this,a,"remove")),Composer.array.erase(this._models,a),this.fire_event("remove",b,a),void this._remove_reference(a)))},add_event:function(a,b){return this.filter(a,this)?(this.refresh({silent:!0}),this.options.sort_event&&this.fire_event("sort",b),void this.fire_event("add",b,a,this,b)):!1},remove_event:function(a,b){return this._models.indexOf(a)<0?!1:(this.refresh({silent:!0}),void this.fire_event("remove",b,a))},forward_event:function(a,b,c){return this.options.forward_all_events?b&&"model"==b.__composer_type&&!this.filter(b,this)?!1:void this.trigger.apply(this,c):!1}});this.Composer.exp0rt({FilterCollection:a})}.apply("undefined"!=typeof exports?exports:this);var util={getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},share:function(a){var b=FACEBOOK_SHARE_URL;a&&(b+=encodeURIComponent("/fax/")+a),"undefined"!=typeof window.org&&window.org&&(b+=encodeURIComponent("?org=")+window.org),window.open(b)},tweet:function(a){var b=window.location.protocol+"//"+window.location.host;if(a&&(b+="/fax/"+a),"undefined"!=typeof window.org&&window.org&&(b+="?org="+window.org),a)var c=encodeURIComponent(FAXED_TWEET+b);else var c=encodeURIComponent(DEFAULT_TWEET+b);window.open("https://twitter.com/intent/tweet?text="+c)},generateSpinner:function(){var a=$c("div");a.className="_fax_spinner_container";var b=$c("div");b.className="_fax_spinner",a.appendChild(b);for(var c=1;12>=c;c++){var d=$c("div");d.className="_fax_blade _fax_d"+(10>c?"0"+c:c);var e=$c("div");d.appendChild(e),b.appendChild(d)}return a},supportsLocalstorage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},validatePhone:function(a){return a=a.replace(/\s/g,"").replace(/\(/g,"").replace(/\)/g,""),a=a.replace("+","").replace(/\-/g,""),"1"==a.charAt(0)&&(a=a.substr(1)),10!=a.length?!1:a}},BaseModalController=Composer.Controller.extend({elements:{"div.overlay":"overlay","div.gutter":"gutter"},events:{"click .gutter":"click_close"},inject:"body",base_render:function(){var a=$c("div");a.className="overlay invisible";var b=$c("div");return b.className="gutter",a.appendChild(b),a},click_close:function(a){(a.target==this.gutter||"close"==a.target.className)&&(a.preventDefault(),this.hide())},show:function(){this.overlay.style.display="block",setTimeout(function(){this.overlay.className="overlay"}.bind(this),50)},hide:function(){this.overlay.classList.add("invisible"),"function"==typeof this.before_hide&&this.before_hide(),setTimeout(function(){this.release()}.bind(this),400)}}),BaseShareModalController=BaseModalController.extend({events:{"click a.close":"click_close","click .social.twitter":"tweet","click .social.facebook":"share"},elements:{},share:function(a){a.preventDefault(),util.share()},tweet:function(a){a.preventDefault(),util.tweet()}}),OrgReferralController=Composer.Controller.extend({init:function(){this.with_bind(this,"submit",this.submit.bind(this)),this.handleDisclosure()},handleDisclosure:function(){if("undefined"!=typeof window.org&&window.org)for(var a=this.el.querySelectorAll("p"),b=0;b<a.length;b++)-1==a[b].className.indexOf(window.org)?a[b].style.display="none":a[b].style.display="block"},submit:function(a,b){if(b||(b={}),"undefined"!=typeof window.org&&window.org||b.default_org){console.log("submit: ",a.email,"; org: ",org);var c=new FormData;c.append("guard",""),c.append("hp_enabled",!0),c.append("member[email]",a.email),a.first_name&&c.append("member[first_name]",a.first_name),a.address1&&c.append("member[street_address]",a.address1),a.zip&&c.append("member[postcode]",a.zip),a.subject&&c.append("subject",a.subject),a.action_comment&&c.append("action_comment",a.action_comment),c.append("org",window.org||b.default_org),c.append("tag",TAG);var d="https://queue.fightforthefuture.org/action",e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&console.log("response:",e.response)}.bind(this),e.open("post",d,!0),e.send(c)}}}),CallModalController=BaseModalController.extend({events:{"click a.close":"click_close","submit form":"submit","click ._call_controls a":"showShareModal"},elements:{input:"phone_number",button:"button"},zipcode:null,init:function(a){this.render(),this.show(),this.with_bind(this,"setZipcode",this.setZipcode.bind(this))},render:function(){var a=this.base_render();a.firstChild.appendChild(CallModalView()),this.html(a)},before_hide:function(){},submit:function(a){a.preventDefault(),console.log("Call submit");var b=this.phone_number.value;if(!util.validatePhone(b))return alert("Please enter a valid US phone number!");var c=new FormData;c.append("campaignId",CALL_CAMPAIGN),this.zipcode&&c.append("zipcode",this.zipcode),c.append("userPhone",util.validatePhone(b));var d="https://call-congress.fightforthefuture.org/create",e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&console.log("sent!",e.response)}.bind(this),e.open("post",d,!0),e.send(c),this.button.disabled=!0,this.button.className="gray",this.button.textContent="calling...",setTimeout(function(){new CallScriptModalController,this.hide()}.bind(this),3e3)},setZipcode:function(a){a&&(this.zipcode=a)},showShareModal:function(a){a.preventDefault(),new CallShareModalController,this.hide()}}),CallScriptModalController=BaseShareModalController.extend({init:function(){this.render(),this.show()},render:function(){var a=this.base_render();a.firstChild.appendChild(CallScriptModalView({})),this.html(a)}}),CallShareModalController=BaseShareModalController.extend({init:function(){this.render(),this.show()},render:function(){var a=this.base_render();a.firstChild.appendChild(CallShareModalView({})),this.html(a)}}),FaxComposerFormController=Composer.Controller.extend({events:{"click ._fax_photo":"addPhoto","click ._fax_webcam":"showWebcamModal","click ._fax_file":"openFile","change input[type=file]":"handleFile","click ._fax_preview a":"clearPhoto","click ._fax_submit":"submitFax","click .social.facebook":"share","click .social.twitter":"tweet","focus textarea":"focusTextarea","blur textarea":"blurTextarea","keydown textarea":"autosizeTextarea"},elements:{textarea:"textarea","._fax_photo":"photo_button","._fax_photo ul":"photo_menu","input[type=file]":"file","._fax_preview":"preview","input._fax_email":"email","._fax_submit":"submit_button","._fax_thanks":"thanks_container","._fax_body":"body_container","._fax_user":"user_container",ul:"menu"},el:"#compose",user:null,photoData:null,editKey:null,sentFaxAccessToken:null,faxTag:null,defaultTextareaText:"Enter your fax here.",defaultAvatarUrl:"/images/site/default_avatar.png",init:function(){this.render(),this.with_bind(this,"showForm",this.showComposeForm.bind(this)),this.with_bind(this,"hideForm",this.hideComposeForm.bind(this)),this.menu.addEventListener("mouseleave",this.hidePhotoMenu.bind(this))},render:function(){var a=FaxComposerFormView({defaultText:this.defaultTextareaText});this.html(a)},focusTextarea:function(){this.textarea.value==this.defaultTextareaText&&(this.textarea.value=""),this.textarea.className="_fax_expanded"},blurTextarea:function(){""==this.textarea.value&&(this.textarea.style.cssText="",this.textarea.value=this.defaultTextareaText,this.textarea.className="")},autosizeTextarea:function(){var a=this.textarea;setTimeout(function(){a.style.cssText="height:auto;";var b=a.scrollHeight>108?a.scrollHeight:95;a.style.cssText="height:"+b+"px"},0)},addPhoto:function(a){a.preventDefault(),this.showPhotoMenu()},showPhotoMenu:function(){this.photo_button.className="_fax_photo _fax_active",this.photo_menu.style.display="block"},hidePhotoMenu:function(){this.photo_button.className="_fax_photo",this.photo_menu.style.display="none"},showWebcamModal:function(a){a.preventDefault(),this.track_subcontroller("webcam_modal",function(){var a=new FaxWebcamModalController({});return this.with_bind_once(a,"attach",function(a){this.photoData=a,this.showPhoto()}.bind(this),"webcam_attached_file"),a}.bind(this))},getBase64PhotoData:function(){return this.photoData.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")},openFile:function(){this.file.click()},handleFile:function(){if(this.file.files&&this.file.files[0]){var a=new FileReader;a.onload=function(a){this.photoData=a.target.result,this.showPhoto()}.bind(this),a.readAsDataURL(this.file.files[0])}},showPhoto:function(){this.preview.style.backgroundImage="url("+this.photoData+")",this.preview.style.backgroundSize="auto 100%",this.preview.style.backgroundPosition="center center",this.preview.style.backgroundRepeat="no-repeat",this.preview.style.display="block",this.photo_button.style.display="none"},clearPhoto:function(a){a.preventDefault(),this.photoData=null,this.preview.style.display="none",this.photo_button.style.display="inline-block",this.file.value=""},submitFax:function(){var a=this.textarea.value.trim();if(a==this.defaultTextareaText||""==a)return alert("Please enter a message to Congress :)"),this.textarea.focus();this.submit_button.disabled=!0;var b=new FormData;user&&user.get("social_user_id")&&b.append("social_user_id",user.get("social_user_id")),this.file.files&&this.file.files[0]?b.append("photo_file",this.file.files[0]):this.photoData&&b.append("photo_data",this.getBase64PhotoData()),this.editKey&&b.append("edit_token",this.editKey),this.faxTag&&b.append("tag",this.faxTag),b.append("email",this.email.value.trim()),b.append("body",a);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState){this.submit_button.disabled=!1;var a=JSON.parse(c.response);if(console.log("RESPONSE: ",a),a.error)return alert(a.error);this.editKey=null,this.sentFaxAccessToken=a.access_token,a._is_new=!0,new FaxModalController({fax:a}),"undefined"!=typeof window.orgController&&orgController.trigger("submit",{email:this.email.value.trim()}),this.hideComposeForm()}}.bind(this),c.open("post","/fax",!0),c.send(b)},hideComposeForm:function(){this.body_container.style.display="none",this.thanks_container.style.display="block"},showComposeForm:function(a){this.body_container.style.display="inline-block",this.thanks_container.style.display="none",a&&(this.textarea.value=a.body,this.focusTextarea(),this.autosizeTextarea(),a.edit_token&&(this.editKey=a.edit_token))},share:function(a){a.preventDefault(),util.share(this.sentFaxAccessToken)},tweet:function(a){a.preventDefault(),util.tweet(this.sentFaxAccessToken)}}),FaxModalController=BaseModalController.extend({events:{"click a.close":"click_close","click a._fax_edit":"editFax","click a._fax_send":"sendFax","click a._fax_add_twitter":"connectTwitter","click .social.twitter":"tweet","click .social.facebook":"share"},elements:{"._fax_spinner_container":"spinner","._fax_page a":"page","._fax_edit_options":"edit_options"},fax:null,init:function(a){var b=util.getParameterByName("e");b&&!this.fax.edit_token&&(this.fax.edit_token=b),console.log("fax: ",this.fax),this.render(),this.show();var c=new Image;c.src="/fax/"+this.fax.access_token+"/image.png",c.onload=this.showPage.bind(this),setTimeout(this.showPage.bind(this),4e3)},render:function(){var a=this.base_render();a.firstChild.appendChild(FaxModalView({fax:this.fax,user:user.toJSON()})),this.html(a),document.body.className=document.body.className+" _fax_no_overflow"},before_hide:function(){var a=document.body.className;document.body.className=a.replace(/_fax_no_overflow/g,"")},editFax:function(a){a.preventDefault(),faxForm.trigger("showForm",this.fax),window.location.href="#_fax_form",this.hide()},sendFax:function(a){a.preventDefault(),this.hide()},share:function(a){a.preventDefault();var b=null;(this.fax._is_new||this.fax.edit_token)&&(b=this.fax.access_token),util.share(b)},tweet:function(a){a.preventDefault();var b=null;(this.fax._is_new||this.fax.edit_token)&&(b=this.fax.access_token),util.tweet(b)},connectTwitter:function(a){a.preventDefault(),user.openLoginModal(),this.with_bind_once(user,"login",this.addTwitter.bind(this),"login")},blurPage:function(){this.page.style.opacity=".3",this.spinner.style.display="block"},showPage:function(){this.page.style.opacity=1,this.spinner.style.display="none"},addTwitter:function(){this.blurPage(),this.edit_options.style.display="none";var a=new FormData;a.append("social_user_id",user.get("social_user_id")),a.append("edit_token",this.fax.edit_token),console.log("edit token: ",this.fax.edit_token);var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState){var a=JSON.parse(b.response);if(a.error)return this.showPage(),this.edit_options.style.display="block",alert(a.error);console.log("response: ",a);var c=new Image,d="/fax/"+this.fax.access_token+"/image.png?replace=1";c.src=d;var e=function(){this.showPage(),this.page.href=d,this.page.style.backgroundImage="url("+d+")",this.page.style.backgroundSize="100% 100%"}.bind(this);c.onload=e,setTimeout(e,4e3)}}.bind(this),b.open("post","/fax/"+this.fax.access_token+"/addTwitter",!0),b.send(a)}}),FaxWebcamModalController=BaseModalController.extend({events:{"click a.close":"click_close","click ._fax_photo_take":"takePhoto","click ._fax_photo_retake":"resetPhoto","click ._fax_photo_use":"usePhoto"},elements:{video:"video",canvas:"canvas","._fax_frame":"frame",audio:"shutter","._fax_flash":"flash","._fax_photo_take":"take_photo","._fax_photo_use":"use_photo","._fax_photo_retake":"retake_photo",img:"photo"},width:640,height:0,streaming:!1,streamRef:null,photoData:null,init:function(){this.render(),this.show(),setTimeout(function(){this.initializeWebcam()}.bind(this),300)},render:function(){var a=this.base_render();a.firstChild.appendChild(FaxWebcamModalView()),this.html(a)},initializeWebcam:function(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(a){if(this.streamRef=a,navigator.mozGetUserMedia)this.video.mozSrcObject=a;else{var b=window.URL||window.webkitURL;this.video.src=b.createObjectURL(a)}this.video.play()}.bind(this),function(a){console.log("An error occured! "+a)}.bind(this)),this.video.addEventListener("canplay",function(a){var b=this.video;this.streaming||(this.height=b.videoHeight/(b.videoWidth/this.width),isNaN(this.height)&&(this.height=this.width/(4/3)),b.setAttribute("width",this.width),b.setAttribute("height",this.height),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this.streaming=!0)}.bind(this),!1)},before_hide:function(){this.streamRef&&(this.streamRef.stop(),this.streamRef=null)},takePhoto:function(){if(!this.streaming)return this.initializeWebcam();var a=this.canvas.getContext("2d");this.width&&this.height&&(this.canvas.width=this.width,this.canvas.height=this.height,a.drawImage(this.video,0,0,this.width,this.height),this.shutter.play(),this.flash.style.display="block",setTimeout(function(){this.flash.style.display="none"}.bind(this),2500),this.photoData=this.canvas.toDataURL("image/png"),this.photo.setAttribute("src",this.photoData),this.video.style.display="none",this.photo.style.display="block",setTimeout(function(){this.take_photo.style.display="none",this.use_photo.style.display="inline-block",this.retake_photo.style.display="inline-block"}.bind(this),125))},resetPhoto:function(){this.take_photo.style.display="inline-block",this.use_photo.style.display="none",this.retake_photo.style.display="none",this.video.style.display="block",this.photo.style.display="none"},usePhoto:function(){this.trigger("attach",this.photoData),this.hide()}}),EmailPetitionController=Composer.Controller.extend({elements:{"input[name=first_name]":"first_name","input[name=email]":"email","input[name=address1]":"address1","input[name=zip]":"zip","input[name=subject]":"subject",textarea:"textarea","div.thanks":"thanks",form:"form"},events:{"submit form":"submit"},orgController:null,init:function(){this.orgController=new OrgReferralController({el:"#petition_disc"})},submit:function(a){a.preventDefault(),console.log("submit");var b=!1,c=function(a){a.className="error",b=!0};if(this.first_name.value||c(this.first_name),this.email.value||c(this.email),this.address1.value||c(this.address1),this.zip.value||c(this.zip),b)return alert("Please fill out all fields :)");this.orgController.submit({email:this.email.value,first_name:this.first_name.value,address1:this.address1.value,zip:this.zip.value,subject:EMAIL_SUBJECT,action_comment:this.textarea.value},{default_org:"fftf"}),this.form.style.display="none",this.thanks.style.display="block";var d=new CallModalController;d.trigger("setZipcode",this.zip.value)}}),SenatorController=Composer.Controller.extend({events:{"click a.tw":"tweet","click h4":"tweet","click .img":"tweet"},model:null,init:function(){this.render()},render:function(){var a=SenatorView({senator:this.model.toJSON()});this.html(a),this.el.className="senator"},tweet:function(a){a.preventDefault();var b=encodeURIComponent(".@"+this.model.get("twitter")+", "+EMERGENCY_TWEET);window.open("https://twitter.com/intent/tweet?text="+b)}}),SenatorListController=Composer.ListController.extend({elements:{"div.target_list":"el_list",select:"select"},events:{"change select":"sort"},inject:"#targets",collection:null,init:function(){this.render(),this.track(this.collection,function(a,b){return new SenatorController({inject:this.el_list,model:a})}.bind(this),{bind_reset:!0}),this.sort()},render:function(){var a=SenatorListView({});this.html(a)},sort:function(){var a=this.select.options[this.select.selectedIndex].value;"name"==a?this.collection.sortfn=function(a,b){return a.get("last_name")<b.get("last_name")?-1:a.get("last_name")>b.get("last_name")?1:0}:this.collection.sortfn=function(a,b){return a.get("state")<b.get("state")?-1:a.get("state")>b.get("state")?1:0},this.collection.sort()}}),UserModel=Composer.Model.extend({init:function(){util.supportsLocalstorage()&&localStorage.user&&this.doLoginUser(JSON.parse(localStorage.user))},openLoginModal:function(){var a="toolbar=no,location=yes,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=640,height=480";window.open("/auth/twitter","billy",a)},authSuccess:function(a){this.doLoginUser(JSON.parse(a))},doLoginUser:function(a){this.set(a),util.supportsLocalstorage()&&(localStorage.user=JSON.stringify(a)),this.trigger("login")},doLogoutUser:function(a){this.clear(),util.supportsLocalstorage()&&delete localStorage.user,this.trigger("logout")}}),CallModalView=function(a){var b=$c("div");b.className="modal _call_modal";var c=$c("a");c.className="close",c.textContent="",c.href="#",b.appendChild(c);var d=$c("h2");d.textContent="Thanks! Now can you call your senators?",b.appendChild(d);var e=$c("p");e.textContent="With just hours before a crucial vote, phone calls are the best way to reach your lawmakers quickly. Enter your phone number and we'll call your phone and connect you to your Senators.",b.appendChild(e);var f=$c("div");f.className="_call_controls";var g=$c("form"),h=$c("input");h.placeholder="Your phone number",g.appendChild(h);var i=$c("button");i.textContent="Call now!",i.type="submit",g.appendChild(i),f.appendChild(g);var j=$c("a");return j.href="#",j.textContent="Can't make a call? Click here to share this page instead!",f.appendChild(j),b.appendChild(f),b},CallScriptModalView=function(a){var b=$c("div");b.className="modal _call_modal";var c=$c("a");c.className="close",c.textContent="",c.href="#",b.appendChild(c);var d=$c("h2");d.textContent="Awesome! We're calling your phone!",b.appendChild(d);var e=$c("p");e.className="nopad",e.textContent="Please be polite and tell your lawmaker:",b.appendChild(e);var f=$c("div");f.className="_call_script",f.textContent="Please oppose CISA, the Cybersecurity Information Sharing Act. CISA won't fix cybersecurity. It will only lead to more warrantless mass-surveillance of innocent Americans. We need real cybersecurity and it's not CISA.",b.appendChild(f);var g=$c("div");g.className="_call_shares";var c=$c("a");c.className="social twitter",c.href="#",c.textContent="Tweet this",g.appendChild(c);var c=$c("a");c.className="social facebook",c.href="#",c.textContent="Share this",g.appendChild(c);var c=$c("a");return c.className="social donate",c.href="https://donate.fightforthefuture.org?amount=5",c.textContent="Donate $5",c.target="_blank",g.appendChild(c),b.appendChild(g),b},CallShareModalView=function(a){var b=$c("div");b.className="modal _call_modal";var c=$c("a");c.className="close",c.textContent="",c.href="#",b.appendChild(c);var d=$c("h2");d.textContent="Please share this page to spread the word.",b.appendChild(d);var e=$c("p");e.textContent="We can still win this if enough people take action!",b.appendChild(e);var f=$c("div");f.className="_call_shares";var c=$c("a");c.className="social twitter",c.href="#",c.textContent="Tweet this",f.appendChild(c);var c=$c("a");c.className="social facebook",c.href="#",c.textContent="Share this",f.appendChild(c);var c=$c("a");return c.className="social donate",c.href="https://donate.fightforthefuture.org?amount=5",c.textContent="Donate $5",c.target="_blank",f.appendChild(c),b.appendChild(f),b},FaxComposerFormView=function(a){var b=$c("div");b.className="_fax_form",b.id="_fax_form";var c=$c("div");c.className="_fax_body";var d=$c("textarea");d.value=a.defaultText,c.appendChild(d);var e=$c("div");e.className="_fax_controls";var f=$c("a");f.className="_fax_photo";var g=$c("i");g.className="fa fa-camera",f.appendChild(g);var h=$c("span");h.textContent="Add photo",f.appendChild(h);var i=$c("ul"),j=$c("li"),k=$c("a");k.className="_fax_webcam",k.href="#",k.textContent="From webcam",j.appendChild(k),i.appendChild(j);var l=$c("li"),m=$c("a");m.className="_fax_file",m.href="#",m.textContent="Attach file",l.appendChild(m),i.appendChild(l),f.appendChild(i),e.appendChild(f);var n=$c("div");n.className="_fax_preview";var o=$c("a");o.textContent="",o.href="#",n.appendChild(o),e.appendChild(n);var p=$c("input");p.type="file",e.appendChild(p);var q=$c("div");q.className="_fax_right";var r=$c("input");r.type="text",r.className="_fax_email",r.placeholder="Your email (optional)",r.name="email",q.appendChild(r);var f=$c("button");f.className="_fax_submit";var g=$c("i");g.className="fa fa-fax",f.appendChild(g);var h=$c("span");h.textContent="Fax now",f.appendChild(h);var s=util.generateSpinner();f.appendChild(s),q.appendChild(f),e.appendChild(q),c.appendChild(e),b.appendChild(c);var t=$c("div");t.className="_fax_thanks";var u=$c("h1");u.textContent="Thanks for faxing! You rock!",t.appendChild(u);var v=$c("p");v.textContent="Help us keep up the momentum! Please share this page.",t.appendChild(v);var w=$c("a");w.className="social twitter",w.href="#",w.textContent="Tweet this",t.appendChild(w);var w=$c("a");w.className="social facebook",w.href="#",w.textContent="Share this",t.appendChild(w);var w=$c("a");return w.className="social donate",w.href="https://donate.fightforthefuture.org?amount=5",w.textContent="Donate $5",w.target="_blank",t.appendChild(w),b.appendChild(t),b},FaxModalView=function(a){var b=$c("div");b.className="modal _fax_modal";var c=$c("a");c.className="close",c.textContent="",c.href="#",b.appendChild(c);var d=$c("div");d.className="_fax_top";var e=$c("h2");a.fax._is_new||a.fax.edit_token?e.textContent="We're sending your fax to Congress!":e.textContent="We're sending this fax to Congress!",d.appendChild(e);var f=$c("p"),g=$c("em");if(g.textContent="Help us stop Congress from wrecking online privacy.",a.fax.edit_token||f.appendChild(g),a.fax.edit_token||a.fax._is_new){var h=$c("span");h.textContent=" Please share your fax, and donate if you can!",f.appendChild(h)}else{var c=$c("a");c.href="#",c.className="_fax_send",c.textContent="Click here to send a fax.",f.appendChild(c)}d.appendChild(f);var c=$c("a");c.className="social twitter",c.href="#",c.textContent="Tweet this",d.appendChild(c);var c=$c("a");c.className="social facebook",c.href="#",c.textContent="Share this",d.appendChild(c);var c=$c("a");if(c.className="social donate",c.href="https://donate.fightforthefuture.org?amount=5",c.textContent="Donate $5",c.target="_blank",d.appendChild(c),b.appendChild(d),a.fax.edit_token){var i=$c("div");if(i.className="_fax_edit_options",a.fax.edit_token&&!a.fax._is_new){var c=$c("a");c.className="_fax_edit",c.href="#";var j=$c("strong");j.textContent="Click here to edit your Fax...",c.appendChild(j),i.appendChild(c);var h=$c("span");i.appendChild(h),b.appendChild(i)}else if(!a.user.social_user_id){var c=$c("a");c.className="_fax_add_twitter",c.href="#";var h=$c("span");h.textContent="Add your Twitter profile to your fax!",c.appendChild(h),i.appendChild(c),b.appendChild(i)}}var k=$c("div");k.className="_fax_page";var c=$c("a");c.className="_fax_image",c.style.backgroundImage="url(/fax/"+a.fax.access_token+"/image.png)",c.style.backgroundSize="100% 100%",c.href="/fax/"+a.fax.access_token+"/image.png",c.target="_blank";var l=util.generateSpinner();k.appendChild(l),k.appendChild(c);var m=$c("div");m.className="_fax_promo";var h=$c("span");h.textContent="Faxes powered by ",m.appendChild(h);var c=$c("a");c.href="https://www.faxrobot.com",c.target="_blank",c.textContent="Fax Robot",m.appendChild(c);var h=$c("span");h.textContent=" and ",m.appendChild(h);var c=$c("a");return c.href="https://www.fightforthefuture.org",c.target="_blank",c.textContent="Fight for the Future",m.appendChild(c),k.appendChild(m),b.appendChild(k),b},FaxWebcamModalView=function(a){var b=$c("div"),c=$c("div");c.className="_fax_flash",b.appendChild(c);var d=$c("div");d.className="modal _fax_photo_modal";var e=$c("a");e.className="close",e.textContent="",e.href="#",d.appendChild(e);var f=$c("div");f.className="_fax_photo_modal_body";var g=$c("div");g.className="_fax_video_container";var h=$c("video");h.id="_fax_video",g.appendChild(h);var i=$c("div");i.className="_fax_frame",g.appendChild(i),f.appendChild(g);var j=$c("canvas");j.className="_fax_canvas",f.appendChild(j);var k=$c("img");k.className="_fax_photo",f.appendChild(k);var l=$c("div");l.className="_fax_photo_controls";var m=$c("button");m.textContent="Take Photo",m.className="_fax_photo_take",l.appendChild(m);var n=$c("button");n.textContent="Use Photo",n.className="_fax_photo_use",l.appendChild(n);var o=$c("button");o.textContent="Retake Photo",o.className="_fax_photo_retake _fax_gray",l.appendChild(o),f.appendChild(l);var p=$c("audio");p.preload="auto";var q=$c("source");q.src="/audio/photoShutter.mp3",q.type="audio/mpeg",p.appendChild(q);var r=$c("source");return r.src="/audio/photoShutter.ogg",r.type="audio/ogg",p.appendChild(r),f.appendChild(p),d.appendChild(f),b.appendChild(d),b},SenatorView=function(a){var b=$c("div"),c=$c("div");c.style.background="url(../congress/"+a.senator.image+") center center",c.style.backgroundSize="100% auto",c.className="img",b.appendChild(c);var d=$c("h4");d.textContent=a.senator.first_name+" "+a.senator.last_name,b.appendChild(d);var e=$c("h3");e.textContent=a.senator.state,b.appendChild(e);var f=$c("ul"),g=$c("li"),h=$c("a");h.href="tel://"+a.senator.phone,h.textContent=a.senator.phone,g.appendChild(h),f.appendChild(g);var i=$c("li"),j=$c("a");return j.href="https://twitter.com/"+a.senator.twitter,j.className="tw",j.textContent="@"+a.senator.twitter,i.appendChild(j),f.appendChild(i),b.appendChild(f),b},SenatorListView=function(a){var b=$c("div"),c=$c("label");c.textContent="Sort by:",c.htmlFor="senator_sort_select",b.appendChild(c);var d=$c("select"),e=$c("option");e.value="name",e.textContent="Senator name",d.appendChild(e);var e=$c("option");e.value="state",e.textContent="Senator state",d.appendChild(e),b.appendChild(d);var f=$c("div");return f.className="target_list",b.appendChild(f),b},$c=document.createElement.bind(document),IMG_HEIGHT=80,scroll_listeners={},DEFAULT_TWEET="It's baffling how poorly Congress seems to understand technology. #FaxBigBrother #StopCISA pic.twitter.com/7SdsKf4C3p ",FAXED_TWEET="Congress doesn't understand modern technology, so I FAXED them to #StopCISA (yet another spying bill). Check it out: ",EMERGENCY_TWEET="please vote NO on #CISA! If you vote yes, I pledge to vote against your re-election. https://www.faxbigbrother.com",FACEBOOK_SHARE_URL="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.faxbigbrother.com%2F",TAG="faxbigbrother",CALL_CAMPAIGN="cisa-cloture-fax",EMAIL_SUBJECT="Please stop CISA",FAX_TAG="companies";-1!=document.referrer.indexOf("reddit")&&(document.getElementById("default_action").style.display="none",document.getElementById("reddit_alt").style.display="block");for(var fb=document.querySelectorAll("a.facebook"),i=0;i<fb.length;i++)fb[i].addEventListener("click",function(a){a.preventDefault(),util.share()},!1);for(var tw=document.querySelectorAll("a.twitter"),i=0;i<tw.length;i++)tw[i].addEventListener("click",function(a){a.preventDefault(),util.tweet()},!1);var org=util.getParameterByName("org"),orgController=new OrgReferralController({el:"#disclosures"}),user=new UserModel,faxForm=new FaxComposerFormController({faxTag:FAX_TAG});util.getParameterByName("call")&&new CallModalController;